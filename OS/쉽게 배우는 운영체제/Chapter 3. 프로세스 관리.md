    # Chapter 3. 프로세스 관리

# 01 프로세스의 개요

## 프로그램 vs 프로세스

프로그램: 어떤 데이터로 어떤 작업을 할지가 저장됨 - 하드디스크 등 저장장치에 존재

프로세스: 프로그램을 메모리에 올려 실행하면 프로세스가 됨

## Process Control Block(PCB)

OS가 프로세스를 관리하는데 필요한 데이터가 저장되는 자료구조

PCB가 생성되면서 프로그램 코드가 메모리에 올라오면 프로세스가 실행됨.

### 구성 요소 - 개요

- 프로세스 구분자
- 메모리 관련 정보: 프로세스의 메모리에서의 위치, 경계 및 한계 레지스터 값 등
- 각종 중간 값: 프로그램 카운터를 비롯한 레지스터들에 저장된 정보

컴퓨터에서는 사용자가 실행한 프로세스 뿐만 아니라 커널의 프로세스 또한 실행되고 있다.

## 프로세스의 여러 상태들

### 1. 생성(Create)

프로그램이 메모리에 올라오고 OS가 PCB를 생성.

메모리에서의 위치:

- PCB - OS 영역
- 프로세스 - 사용자 영역

### 2. 준비(Ready)

시분할 시스템에서는 여러 프로세스들이 존재, CPU를 할당받을 때 까지 준비 큐(Ready Queue)에서 대기.

### 3. 실행(Running)

CPU 스케쥴러는 실행할 프로세스를 Ready Queue에서 선택한 뒤 실행시키는데 이 작업을 dispatch라고 하고, 이를 수행하는 명령은 dispatch(PID)다.

일정 시간 동안 CPU를 할당 받는데, 이 시간을 타임 슬라이스 또는 타임 퀀텀이라고 한다.

할당 받은 시간 내에 모든 명령을 수행했다면:

exit(PID)가 호출되며, 종료 상태로 변경된다.

만약 수행을 완료하지 못했다면:

timeout(PID)가 호출됨으로써, 다시 준비 상태가 되며, Ready Queue에 프로세스가 실린다. 

### 4. 대기(Blocking)

입출력 등을 수행할 때 입출력 관리자 등에게 인터럽트를 받을 때 까지 입출력 장치별로 할당된 큐로 프로세스가 이동되며(block(PID)), 그동안은 다른 프로세스들이 CPU 사용. 인터럽트를 받았다면 준비 상태로 변경(wakeup(PID)).

### 5. 종료(Terminate)

정상 종료의 경우:

프로세스가 점유하던 메모리를 해제하고 PCB를 폐기한다

비정상 종료(abort)의 경우:

오류의 원인을 찾을 수 있도록 메모리에 저장된 값들을 하드디스크 등에 기록하는 core dump를 수행한다.

### Active Status

위 5가지 상태가 활성 상태(Active Status)다.

활성 상태가 아닌 프로세스 상태에는 휴식 상태, 보류 상태 등이 있다.

### 휴식 상태(Pause)

메모리의 데이터는 유지된 채 실행을 잠시 멈춘다.

### 보류 상태(Suspend)

스왑 영역(swap area)으로 프로세스와 연관된 데이터들이 메모리로 부터 쫒겨난다. 스왑 영역은 이러한 메모리에서 쫒겨난 데이터들이 임시로 보관되는 곳이다.

아래 경우들이 보류 상태가 되는 사례에 해당한다.

- 메모리가 꽉 차서 프로세스를 메모리 밖으로 보내야 할 때
- 입출력의 지연
- 악성코드를 포함하는 바이러스로 판단됨
- 오류로 인해 실행을 보류해야함
- 주기가 긴 프로세스라 메모리 밖으로 쫒아내도 무방할 때

보류 대기(block suspend) 상태

대기(blocking) 상태에서 보류 상태로 전환될 때에 해당한다.

입출력이 완료되었다고 인터럽트를 받으면 보류 준비 상태가 된다.

보류 준비(ready suspend) 상태

준비 상태에서 보류 상태로 전환될 때에 해당한다

재시작 시 준비 상태(활성 상태에 해당)로 전환된다.

# 02 프로세스 제어 블록과 문맥 교환

## 프로세스 제어 블록

프로세스 제어 블록(Process Control Block)은 프로세스를 관리하는데에 있어 중요한 데이터들을 보관하는 자료 구조로,TCB(Task Control Block)이라고도 한다.

## 프로세스 제어 블록의 구성요소

### 포인터

첫 번째 블록에는 PCB의 포인터 정보가 저장된다. 이는 준비 큐, 대기 시 이동되는 큐 등을 구현하는데 사용된다.

### 프로세스 상태

두 번째 블록에는 프로세스 상태가 저장된다. 생성, 준비, 실행, 대기, 보류 준비, 보류 대기 등이 있다.

### 프로세스 구분자

### 프로그램 카운터

### 프로세스 우선순위

### 각종 레지스터 정보

### 메모리 관리 정보

### 할당된 자원 정보

프로세스를 실행하기 위해 사용하는 입출력 자원이나 오픈 파일등에 대한 정보가 저장된다. 소리를 출력하기 위해 사운드 카드에 ㅈ

### 계정 정보

계정 번호, CPU 할당 시간, CPU 사용 시간 등이 저장된다.

### 부모 프로세스 구부낮와 자식 프로세스 구분자

PPID(Parent PID)와 CPID(Child PID)가 저장된다. 부모-자식 프로세스 관계는 프로세스를 이해하는데 중요한 개념인데, 3절에서 자세히 알아본다.
